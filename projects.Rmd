---
title: "Seattle's Bicycle Sharing Graphical Analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



We find the orignal information [here](https://proquestionasker.github.io/projects/2016/11/10/bicyclesseattle/).



```{r, echo = FALSE, warning = FALSE, message=FALSE}
#loading data

# For data manipulation and tidying
library(dplyr)
library(lubridate)
library(tidyr)

# For mapping
library(ggmap)
library(mapproj)

# For data visualizations
library(ggplot2)

# For modeling and machine learning
library(caret)
library(lubridate)

station <- read.csv(file = "station.csv", header = TRUE, 
                    stringsAsFactors = FALSE)

trip <- read.csv(file = "trip.csv", header = TRUE, 
                 stringsAsFactors = FALSE)

weather <- read.csv(file = "weather.csv", header = TRUE, 
                    stringsAsFactors = FALSE)
```
##**Introduction** 
This is a report and analysis on Seattle's bicycle sharing trends. The data includes weather reports for the area (excluding summer logistics), the station locations, as well as trips taken by cycle riders. Future explorations of this type of data could include investigating more extensively overall public transportation data trends for this area. This would serve to establish a better understanding of public transportation trends. *Interestingly enough* this transportation company has since dissolved and the data points that were collected from this company are ...

## **Station Locations**
Lets take a look at where the rental stations are located in Seattle!

```{r, label = "stationLocs"}
#For show (the graphs , THE EVI-DANCE) Formating the dates
station$install_date <- mdy(station$install_date)


# How many times were new stations installed?
station %>% summarise(n_distinct(install_date))
# How many stations were installed on each date
station %>% group_by(install_date) %>% summarise(count = n()) %>% 
  arrange(install_date)



station %>% summarise(n_distinct(station_id))

station_locs <- station %>% group_by(station_id) %>% select(1:4, -2)

mymap <- get_map(location = c(lat = 47.60, lon = -122.35), maptype = "roadmap", zoom = 12)

# Plot a single point for each Station ID
ggmap(mymap) + geom_point(aes(x = long, y = lat), data = station_locs, 
                          alpha = 1, color = "darkred", size = 2)
```

##Stations Locations Data

```{r, label = "closeUp", fig.cap= "Stations map Zoomed In", warning=FALSE, message=FALSE, echo = FALSE}
closeUp <- get_map(location = "Seattle", maptype = "roadmap", zoom = 13)

# Plot a single point for each Station ID
ggmap(closeUp) + geom_point(aes(x = long, y = lat), data = station_locs, 
                            alpha = 1, color = "violet", size = 3)
```


Look at all those stations! Its hard to believe they managed to go out of business!


## Histogram of Number of Bikes per Station

```{r, label = "nbs", fig.cap = "Current Dock Count", echo = FALSE, message=FALSE, warning = FALSE}
#histogram showing current dock count
ggplot(data = station, aes (x = current_dockcount)) +
  geom_bar(fill = "yellow", color = "black") +
  theme_classic() +
  labs( x = "Number of bikes per station", y= "Count", title = "Current Dock Count")
```





##Change in Number of Bike Docks Per Station

```{r, label = "bikesPerStation", warning = FALSE, message=FALSE, echo = FALSE}
dock_change <- station %>% group_by(station_id) %>% select(station_id, 
                                                           long, lat, ends_with("dockcount")) %>% mutate(dock_change = current_dockcount - 
                                                                                                           install_dockcount)


closeUp <- get_map(location = "Seattle", maptype = "roadmap", zoom = 13)

ggmap(closeUp) + geom_point(aes(x = long, y = lat, size = factor(dock_change), 
                                color = factor(dock_change)), 
                            data = dock_change, alpha = 0.8) + 
  guides(color = guide_legend(title = "change"), size = guide_legend(title = "change")) + 
  scale_size_manual(values = 10:1)




# Change in docking station 
dock_change <- station %>% group_by(station_id) %>% select(station_id, 
                                                           long, lat, ends_with("dockcount")) %>% mutate(dock_change = current_dockcount -     install_dockcount)


```


```{r, label = "currentStationSize", fig.cap="Current Station Size"}

```


11 stations lost bike docks, 39 docks stayed the same, 8 stations gained docks.


```{r, label = "visualRidesPerDay", fig.cap="Time to visualize the number of rides per day", message=FALSE, echo = FALSE}
# Make the start and stop dates into POSIXct objects
trip_2 <- trip %>% mutate(start_dt = mdy_hm(starttime), stop_dt = mdy_hm(stoptime))

trip_2 <- trip_2 %>% mutate(start_date = paste(month(start_dt), 
                                               day(start_dt), year(start_dt), sep = "/"))
trip_2$start_date <- mdy(trip_2$start_date)

trip_2 <- trip_2 %>% mutate(stop_date = paste(month(stop_dt), 
                                              day(stop_dt), year(stop_dt), sep = "/"))
trip_2$stop_date <- mdy(trip_2$stop_date)


# Recode the dates
trip_2 %>% 
  
  group_by(start_date) %>%
  
  summarize(N = n()) %>%
  
  ggplot(aes(x = start_date, y = N)) + 
  
  geom_line() + 
  
  labs(x = "Date", y = "Number of trips per day") + 
  
  theme_bw() + geom_smooth()


```

##Plotting trips per month (by season; excluding summer)

```{r, label = "monthSeason", fig.cap="Trips Per Month (By Season)", message=FALSE, echo = FALSE}
start_date_ym <- trip_2 %>% 
  mutate(ym = paste(year(start_date), 
                    month(start_date), sep = "/"), Season = ifelse(ym %in% c("2014/10", "2014/11"), "Fall",
                                                                   ifelse(ym %in% c("2014/12", "2015/1", "2015/2"), "Winter",
                                                                          ifelse(ym %in% c("2015/3", "2015/4", "2015/5"), "Spring", "Summer"))))


# ggplot(start_date_ym, aes(x = start_date, y = N))
names(start_date_ym)


start_date_ym %>%
  group_by(ym, Season) %>%
  summarize(N=n()) %>%
  ggplot(aes(x = ym, y = N, color = Season, fill = Season, group = Season)) + 
  geom_point() +
  geom_line(group = 1) + 
  labs( x = "Date", y = "Number of Trips(per month)")
```



# Convert Trip Duration from Seconds to Minutes

```{r, label = "minutesSeason", fig.cap="Average Trip Duration", message=FALSE, echo = FALSE}
Trip_Duration_Month <- start_date_ym %>% 
  mutate(trip_duration_min = tripduration/60) %>% 
  group_by(ym) %>% 
  select(ym, trip_duration_min, Season) %>% 
  summarise(Avg = mean(trip_duration_min), 
            sd = sd(trip_duration_min)) %>% 
  mutate(se = sd/sqrt(n()), Season = ifelse(ym %in% c("2014/10", "2014/11"), "Fall",
                                                                   ifelse(ym %in% c("2014/12", "2015/1", "2015/2"), "Winter",
                                                                          ifelse(ym %in% c("2015/3", "2015/4", "2015/5"), "Spring", "Summer"))))

Trip_Duration_Month %>%
  ggplot(aes(x = ym, y = Avg, col = Season, fill = Season, group = Season)) + 
  geom_point()+
  geom_line(aes(group = 1)) + 
  labs(x = "Date" , y = "Duration of Average Trip (minutes)") + 
  theme_bw() + 
  geom_errorbar(aes(ymin = Avg - se, ymax = Avg + se))
  
```

##Number of Trips by Day of Week

```{r, eval = FALSE, label = "dayOfWeekSeasons", fig.cap="Number of Trips by Day of Week", message=FALSE, echo = FALSE}
#Number of Trips by Day of Week
  
start_date_ym %>%
  group_by(wd, Season) %>%
  summarize(N = n())%>%
  ggplot(aes(x = wd, y = N, col = Season, fill = Season, group = Season)) + 
  geom_point() + 
  geom_line() + 
  theme_bw() + 
  labs(x = "Day of the Week", y= "Number of Trips", title = "Trips Per Day")

```
